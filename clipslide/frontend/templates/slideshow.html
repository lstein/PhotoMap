<!DOCTYPE html>
<html>
  <head>
    <title id="slideshow_title">Slideshow</title>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=10, user-scalable=yes" />
    <link rel="icon" type="image/x-icon" href="static/favicon.ico" />
    <link rel="apple-touch-icon" sizes="180x180" href="static/apple-touch-icon.png" />
    <link rel="stylesheet" type="text/css" href="static/slides.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />
    <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
    <script>
      // Pass server data to JavaScript
      window.slideshowConfig = {
          currentDelay: {{ delay }},
          mode: "{{ mode }}",
          album: {% if album %}"{{ album }}"{% else %}null{% endif %},
          setupMode: {{ setup_mode|lower }}
      };
      
      {% if setup_mode %}
      // ✅ AUTOMATICALLY OPEN ALBUM MANAGER IN SETUP MODE
      document.addEventListener('DOMContentLoaded', function() {
        // Trigger the "no albums found" event to open album manager
        window.dispatchEvent(new CustomEvent('noAlbumsFound'));
      });
      {% endif %}
    </script>
    <script type="module" src="static/main.js"></script>
  </head>

  <body>
    <!-- Fixed score display -->
    <div id="fixedScoreDisplay" class="fixed-score-display hidden">
      <span id="scoreText">score=0.000</span>
    </div>

    <div class="swiper">
      <div class="swiper-wrapper" id="carousel-wrapper">
        <!-- Slides will be added dynamically -->
      </div>
      <div class="swiper-scrollbar"></div>
    </div>

    <!-- Combined Banner and Drawer Container -->
    <div id="bannerDrawerContainer" class="banner-drawer-container">
      <!-- Overlay Drawer Toggle -->
      <div id="overlayDrawer" class="overlay-drawer">
        <div class="drawer-handle">
          <svg class="drawer-arrow" viewBox="0 0 18 18">
            <path d="M7 14l5-5 5 5z" fill="currentColor"/>
          </svg>
        </div>
      </div>
      
      <!-- File Info Banner -->
      <div id="filenameBanner" class="filename-banner">
        <div class="filenameDescContainer">
          <div class="filenameRow">
            <span id="filenameText"></span>
            <button id="copyTextBtn" title="Copy text">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                <path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/>
              </svg>
            </button>
          </div>
          <div id="descriptionText"></div>
          <div id="filepathText"></div>
        </div>
      </div>
    </div>

    <div id="spinner">
      <svg width="60" height="60" viewBox="0 0 50 50">
        <circle cx="25" cy="25" r="20" fill="none" stroke="#888" stroke-width="5" stroke-linecap="round" stroke-dasharray="31.4 31.4" transform="rotate(-90 25 25)">
          <animateTransform attributeName="transform" type="rotate" from="0 25 25" to="360 25 25" dur="1s" repeatCount="indefinite" />
        </circle>
      </svg>
    </div>

    <div id="swiperPrevBtnGroup">
      <div class="swiper-button-prev"></div>
    </div>
    <div id="swiperNextBtnGroup">
      <div class="swiper-button-next"></div>
    </div>

    <div id="bottomLeftBtnGroup">
      <!-- Settings (gear) button, far left -->
      <button id="settingsBtn" title="Settings">
        <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="#fff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="12" cy="12" r="3" />
          <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 1 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-4 0v-.09a1.65 1.65 0 0 0-1-1.51 1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 1 1-2.83-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1 0-4h.09a1.65 1.65 0 0 0 1.51-1 1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 1 1 2.83-2.83l.06.06a1.65 1.65 0 0 0 1.82.33h.09A1.65 1.65 0 0 0 9 3.09V3a2 2 0 0 1 4 0v.09a1.65 1.65 0 0 0 1 1.51h.09a1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 1 1 2.83 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82v.09a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z" />
        </svg>
      </button>

      <button id="deleteCurrentFileBtn" title="Delete image">
        <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="#fff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <polyline points="3 6 5 6 21 6" />
          <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h2a2 2 0 0 1 2 2v2" />
          <line x1="10" y1="11" x2="10" y2="17" />
          <line x1="14" y1="11" x2="14" y2="17" />
        </svg>
      </button>

      <button id="fullscreenBtn" title="Fullscreen">
        <svg width="48" height="48" viewBox="0 0 24 24" fill="#fff">
          <path d="M4 4h6V2H2v8h2V4zm16 0v6h2V2h-8v2h6zm0 16h-6v2h8v-8h-2v6zM4 20v-6H2v8h8v-2H4z" />
        </svg>
      </button>

      <button id="startStopSlideshowBtn" title="Start/Pause Slideshow">
        <span id="slideshowIcon">
          <svg id="playIcon" width="32" height="32" viewBox="0 0 24 24" fill="#fff">
            <polygon points="5,3 19,12 5,21" />
          </svg>
          <svg id="pauseIcon" width="32" height="32" viewBox="0 0 24 24" fill="#fff">
            <rect x="6" y="4" width="4" height="16" />
            <rect x="14" y="4" width="4" height="16" />
          </svg>
        </span>
      </button>
    </div>

    <div id="searchPanel">
      <button id="uploadImageFileBtn" title="Upload image for search">
        <span id="uploadImageIcon">
          <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="#fff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <rect x="3" y="3" width="18" height="18" rx="2" ry="2" />
            <path d="M12 8v8M8 12l4-4 4 4" />
          </svg>
        </span>
        <input type="file" id="uploadImageInput" accept="image/*" />
      </button>
      
      <button id="imageSearchBtn" title="Search for similar images">
        <span id="imageSearchIcon">
          <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="#fff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <rect x="3" y="3" width="18" height="18" rx="2" ry="2" />
            <circle cx="8.5" cy="8.5" r="1.5" />
            <polyline points="21 15 16 10 5 21" />
          </svg>
        </span>
      </button>
      
      <button id="textSearchBtn" title="Search">
        <span id="textSearchIcon">
          <svg id="searchIcon" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="#fff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="11" cy="11" r="8" />
            <line x1="21" y1="21" x2="16.65" y2="16.65" />
          </svg>
        </span>
      </button>
      
      <button id="clearSearchBtn" title="Clear Search">
        <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="#fff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <rect x="4" y="4" width="16" height="16" rx="2" ry="2" />
          <line x1="8" y1="8" x2="16" y2="16" />
          <line x1="16" y1="8" x2="8" y2="16" />
        </svg>
      </button>
    </div>

    <div id="textSearchPanel">
      <div class="search-controls">
        <div class="search-input-container">
          <input id="searchInput" type="text" placeholder="Search..." />
          <button id="clearTextSearchBtn" title="Clear search">&#10005;</button>
        </div>
        <button id="doSearchBtn">Search</button>
      </div>
    </div>

    <!-- Settings Overlay -->
    <div id="settingsOverlay" class="modal-overlay">
      <div class="modal-content settings-modal">
        <button id="closeSettingsBtn" class="modal-close" title="Close settings">✖</button>
        
        <div class="settings-header">
          <span id="modeLabel">Slideshow Settings</span>
        </div>

        <div class="settings-main">
          <!-- Left column: Slower/Faster/Interval -->
          <div class="delay-controls">
            <button id="slowerBtn" title="Slower">&#9650;</button>
            <span id="delayValue">10</span>
            <button id="fasterBtn" title="Faster">&#9660;</button>
            <div id="delayLabel">Interval</div>
          </div>

          <!-- Right column: Mode controls -->
          <div id="modeControls">
            <div id="modeRadioGroup">
              <label><input type="radio" id="modeRandom" name="mode" value="random" checked /> Random</label>
              <label><input type="radio" id="modeSequential" name="mode" value="sequential" /> Sequential</label>
            </div>
          </div>
        </div>

        <!-- Settings rows -->
        <div class="setting-row">
          <label for="highWaterMarkInput">Max Slides in History:</label>
          <input id="highWaterMarkInput" type="number" min="2" max="100" value="10" />
        </div>

        <div class="setting-row">
          <label for="albumSelect">Album:</label>
          <div class="album-selector-group">
            <select id="albumSelect">
              <option value="">Loading albums...</option>
            </select>
            <button id="manageAlbumsBtn" class="btn-primary">Manage Albums</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Album Management Overlay -->
    <div id="albumManagementOverlay" class="modal-overlay album-management">
      <div class="modal-content album-management-modal">
        <!-- Header with Add Album Button -->
        <div class="album-header">
          <h2>Album Management</h2>
          <div class="header-buttons">
            <button id="showAddAlbumBtn" class="btn-primary">+ Add Album</button>
            <button id="closeAlbumManagementBtn" class="modal-close" title="Close">✖</button>
          </div>
        </div>

        <!-- Add New Album Section -->
        <div id="addAlbumSection" class="add-album-section">
          <div class="section-header">
            <h3>Add New Album</h3>
            <button id="cancelAddAlbumBtn" class="cancel-btn" title="Cancel">✖</button>
          </div>

          <div class="form-grid">
            <div class="form-group">
              <label>Album Key</label>
              <input id="newAlbumKey" type="text" placeholder="e.g., vacation_2024" />
            </div>
            <div class="form-group">
              <label>Display Name</label>
              <input id="newAlbumName" type="text" placeholder="e.g., Vacation 2024" />
            </div>
          </div>
          
          <div class="form-group">
            <label>Description</label>
            <input id="newAlbumDescription" type="text" placeholder="Optional description" />
          </div>

          <div class="form-group">
            <label>Image Paths (one per line)</label>
            <textarea id="newAlbumPaths" placeholder="/path/to/images&#10;/another/path/to/images" rows="3"></textarea>
          </div>

          <div class="form-buttons">
            <button id="addAlbumBtn" class="btn-primary">Add Album</button>
            <button id="cancelAddAlbumBtn2" class="btn-secondary">Cancel</button>
          </div>
        </div>

        <!-- Existing Albums Section -->
        <div id="existingAlbumsSection">
          <h3>Albums</h3>
          <div id="albumsList">
            <!-- Albums will be populated here -->
          </div>
        </div>
      </div>
    </div>

    <!-- Album Card Template -->
    <template id="albumCardTemplate">
      <div class="album-card">
        <!-- Album Info Section -->
        <div class="album-info">
          <div class="album-details">
            <!-- Left side - Album details -->
            <div class="album-text">
              <h4 class="album-name"></h4>
              <div class="album-key"></div>
              <div class="album-description"></div>
              <div class="album-paths"></div>
            </div>
            
            <!-- Right side - Index controls -->
            <div class="indexing-section">
              <!-- Index Status and Button -->
              <div class="index-controls">
                <div class="index-status">Ready to index</div>
                <button class="create-index-btn btn-index">Update Index</button>
                <button class="cancel-index-btn btn-cancel">Cancel</button>
              </div>
              
              <!-- Progress Container -->
              <div class="progress-container">
                <div class="progress-bar-wrapper">
                  <div class="progress-bar-track">
                    <div class="progress-bar"></div>
                    <div class="progress-bar-shimmer"></div>
                  </div>
                  <div class="progress-text">0%</div>
                </div>
                <div class="estimated-time"></div>
              </div>
            </div>
          </div>
          
          <!-- Action Buttons Row -->
          <div class="action-buttons">
            <button class="edit-album-btn btn-edit">Edit</button>
            <button class="delete-album-btn btn-delete">Delete</button>
          </div>
        </div>
        
        <!-- Edit Form -->
        <div class="edit-form">
          <h5>Edit Album</h5>
          <div class="form-grid">
            <div class="form-group">
              <label>Display Name</label>
              <input class="edit-album-name" type="text" />
            </div>
            <div class="form-group">
              <label>Description</label>
              <input class="edit-album-description" type="text" />
            </div>
          </div>
          
          <div class="form-group">
            <label>Image Paths (one per line)</label>
            <textarea class="edit-album-paths" rows="3"></textarea>
          </div>

          <div class="form-buttons">
            <button class="save-album-btn btn-primary">Save Changes</button>
            <button class="cancel-edit-btn btn-secondary">Cancel</button>
          </div>
        </div>
      </div>
    </template>
  </body>
</html>